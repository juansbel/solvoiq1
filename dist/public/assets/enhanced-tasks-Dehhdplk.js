import{t as ne,r as c,j as e,ac as L,B as N,l as de,k as E,e as fe,P as me,K as ve,F as ye,h as Ne,u as Te,i as be,ak as we,al as Ce,I as V,C as S,a as k,b as D,c as P,w as Se,x as ke,y as le,z as ce,am as O,o as De,g as Pe,s as z}from"./index-Dsch-6rs.js";import{u as oe}from"./useMutation-CWIftKBJ.js";import{u as Fe,t as Me,f as Ae,F as Ie,a as F,b as M,c as A,d as I}from"./schema-DufpuSdc.js";import{u as Ee}from"./use-debounce-DnMWKfEB.js";import{A as qe}from"./action-button-_bigQsZt.js";import{C as Le,S as B,a as K,b as Q,c as R,d as l}from"./select-DXDaqklB.js";import{P as Ve,a as Be}from"./play-IYu6LyWG.js";import{T as Ke}from"./tag-B2mgWGDT.js";import{D as Qe,a as Re,b as Ue,c as _e,d as $e,e as Ge,f as He}from"./dialog-DSRUCjP6.js";import{T as Oe}from"./textarea-dxwQGyzt.js";import{P as ze}from"./plus-CRp7_VfK.js";import{F as Je}from"./filter-vm137f-V.js";import"./Combination-Cg6MJVDY.js";import"./index-CJCVC222.js";import"./index-8CgwoEGl.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=ne("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=ne("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=ne("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);function J({task:t,onToggleStatus:u,onUpdateTime:U}){const[j,q]=c.useState(!1),[T,_]=c.useState(t.timeSpent||0),[g,f]=c.useState(null),d=t.status==="completed",W=t.status==="in_progress",v=t.estimatedMinutes||30,$=Math.min(T/v*100,100);c.useEffect(()=>{let i;return j&&g&&(i=setInterval(()=>{const h=Date.now(),w=Math.floor((h-g)/(1e3*60));_((t.timeSpent||0)+w)},1e3)),()=>{i&&clearInterval(i)}},[j,g,t.timeSpent]);const b=()=>{q(!0),f(Date.now()),t.status==="pending"&&u(t.id,"in_progress")},X=()=>{if(q(!1),g){const i=Math.floor((Date.now()-g)/6e4),h=(t.timeSpent||0)+i;U(t.id,h),f(null)}},y=()=>{if(q(!1),g){const i=Math.floor((Date.now()-g)/6e4),h=(t.timeSpent||0)+i;U(t.id,h),f(null)}},Y=()=>{j&&y(),u(t.id,d?"pending":"completed")},m=i=>{const h=Math.floor(i/60),w=i%60;return h>0?`${h}h ${w}m`:`${w}m`},r=i=>{switch(i){case"urgent":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},re=i=>{switch(i){case"client":return"bg-blue-100 text-blue-800";case"admin":return"bg-purple-100 text-purple-800";case"marketing":return"bg-pink-100 text-pink-800";case"development":return"bg-indigo-100 text-indigo-800";default:return"bg-slate-100 text-slate-800"}},Z=t.dueDate&&new Date(t.dueDate)<new Date&&!d;return e.jsxs("div",{className:L("border border-slate-200 rounded-lg p-4 transition-all duration-200",d&&"opacity-75 bg-slate-50",W&&"border-blue-300 bg-blue-50",Z&&"border-red-300 bg-red-50"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Y,className:L("w-5 h-5 border-2 rounded mt-0.5 flex items-center justify-center transition-colors",d?"bg-green-500 border-green-500":"border-slate-300 hover:border-primary"),children:d&&e.jsx(Le,{className:"w-3 h-3 text-white"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(N,{className:L("text-xs",r(t.priority||"medium")),children:[e.jsx(We,{className:"w-3 h-3 mr-1"}),t.priority||"medium"]}),t.category&&e.jsx(N,{variant:"outline",className:L("text-xs",re(t.category)),children:t.category}),Z&&e.jsxs(N,{variant:"destructive",className:"text-xs",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),"Overdue"]})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:!d&&e.jsx(e.Fragment,{children:j?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"sm",variant:"outline",onClick:X,className:"h-8 px-2",children:e.jsx(Be,{className:"w-3 h-3"})}),e.jsx(E,{size:"sm",variant:"outline",onClick:y,className:"h-8 px-2",children:e.jsx(Xe,{className:"w-3 h-3"})})]}):e.jsx(E,{size:"sm",variant:"outline",onClick:b,className:"h-8 px-2",children:e.jsx(Ve,{className:"w-3 h-3"})})})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:L("font-medium text-slate-900 mb-1",d&&"line-through"),children:t.name}),e.jsx("p",{className:"text-sm text-slate-600",children:t.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1 text-slate-600",children:[e.jsx(fe,{className:"w-3 h-3"}),m(T)," / ",m(v)]}),j&&e.jsxs("span",{className:"flex items-center gap-1 text-blue-600 animate-pulse",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full"}),"Running"]})]}),e.jsxs("span",{className:"text-slate-500",children:[Math.round($),"%"]})]}),e.jsx(me,{value:$,className:"h-2"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[t.assignedTo&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-3 h-3"}),t.assignedTo]}),t.dueDate&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),new Date(t.dueDate).toLocaleDateString()]})]}),t.tags&&t.tags.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ke,{className:"w-3 h-3"}),e.jsx("span",{children:t.tags.slice(0,2).join(", ")}),t.tags.length>2&&e.jsxs("span",{children:["+",t.tags.length-2]})]})]})]})]})}function us(){const t=Ne(),{toast:u}=Te(),[U,j]=c.useState(!1),[q,T]=c.useState(!1),[_,g]=c.useState(""),f=Ee(_,300),[d,W]=c.useState("all"),[v,$]=c.useState("all"),[b,X]=c.useState("all"),[y,Y]=c.useState("all");c.useEffect(()=>{document.title="Tasks - ClientHub AI"},[]);const m=Fe({resolver:Me(Ae),defaultValues:{userId:"1",name:"",description:"",status:"pending",priority:"medium",category:"general",estimatedMinutes:60,timeSpent:0,assignedTo:"",tags:[],isAiGenerated:!1}}),{data:r=[],isLoading:re,error:Z}=be({queryKey:["/api/tasks"],staleTime:3e4}),i=oe({mutationFn:async s=>(await z("POST","/api/tasks",s)).json(),onSuccess:()=>{t.invalidateQueries({queryKey:["/api/tasks"]}),t.invalidateQueries({queryKey:["/api/statistics"]}),m.reset(),T(!1),u({title:"Task created",description:"Task has been successfully created."})},onError:s=>{console.error("Task creation error:",s),u({title:"Error",description:(s==null?void 0:s.message)||"Failed to create task",variant:"destructive"})}}),h=s=>{i.mutate(s)},w=oe({mutationFn:async({id:s,updates:a})=>(await z("PUT",`/api/tasks/${s}`,a)).json(),onSuccess:()=>{t.invalidateQueries({queryKey:["/api/tasks"]}),t.invalidateQueries({queryKey:["/api/statistics"]}),u({title:"Task updated",description:"Task has been successfully updated."})},onError:s=>{console.error("Task update error:",s),u({title:"Error",description:(s==null?void 0:s.message)||"Failed to update task",variant:"destructive"})}}),C=c.useMemo(()=>r.filter(s=>{const a=s.name.toLowerCase().includes(f.toLowerCase())||s.description.toLowerCase().includes(f.toLowerCase()),o=d==="all"||s.status===d,ee=v==="all"||s.priority===v,se=b==="all"||s.category===b,te=y==="all"||s.assignedTo===y;return a&&o&&ee&&se&&te}),[r,f,d,v,b,y]),x=c.useMemo(()=>{const s=r.length,a=r.filter(n=>n.status==="completed").length,o=r.filter(n=>n.status==="in_progress").length,ee=r.filter(n=>n.status==="pending").length,se=r.filter(n=>n.dueDate&&new Date(n.dueDate)<new Date&&n.status!=="completed").length,te=r.reduce((n,ae)=>n+(ae.timeSpent||0),0),ge=r.reduce((n,ae)=>n+(ae.estimatedMinutes||0),0),pe=s>0?a/s*100:0,je={urgent:r.filter(n=>n.priority==="urgent").length,high:r.filter(n=>n.priority==="high").length,medium:r.filter(n=>n.priority==="medium").length,low:r.filter(n=>n.priority==="low").length};return{totalTasks:s,completedTasks:a,inProgressTasks:o,pendingTasks:ee,overdueTasks:se,totalTimeSpent:te,totalEstimatedTime:ge,completionRate:pe,priorityBreakdown:je}},[r]),p=c.useMemo(()=>({pending:C.filter(a=>a.status==="pending"),in_progress:C.filter(a=>a.status==="in_progress"),completed:C.filter(a=>a.status==="completed")}),[C]),xe=r.reduce((s,a)=>(a.assignedTo&&!s.includes(a.assignedTo)&&s.push(a.assignedTo),s),[]),he=r.reduce((s,a)=>(a.category&&!s.includes(a.category)&&s.push(a.category),s),[]),ue=async()=>{var s;j(!0);try{const o=await(await z("POST","/api/ai/generate-tasks",{suggestions:"Generate tasks based on the general business context and recent client communications"})).json();t.invalidateQueries({queryKey:["/api/tasks"]}),t.invalidateQueries({queryKey:["/api/statistics"]}),u({title:"Success",description:`Generated ${((s=o.tasks)==null?void 0:s.length)||0} new tasks from AI context!`})}catch{u({title:"Error",description:"Failed to generate tasks",variant:"destructive"})}finally{j(!1)}},G=(s,a)=>{const o={status:a};a==="completed"&&(o.completedAt=new Date),w.mutate({id:s,updates:o})},H=async(s,a)=>{try{await z("PATCH",`/api/tasks/${s}/time`,{timeSpent:a}),t.invalidateQueries({queryKey:["/api/tasks"]})}catch(o){console.error("Failed to update task time:",o)}},ie=s=>{const a=Math.floor(s/60),o=s%60;return a>0?`${a}h ${o}m`:`${o}m`};return e.jsx("div",{className:"flex-1 overflow-y-auto p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:we,children:"Enhanced Task Management"}),e.jsx("p",{className:"text-slate-600",children:"Track time, manage priorities, and boost productivity"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(qe,{onClick:ue,loading:U,variant:"success",icon:Ce,children:"Generate AI Tasks"}),e.jsxs(Qe,{open:q,onOpenChange:T,children:[e.jsx(Re,{asChild:!0,children:e.jsxs(E,{variant:"outline",children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),"New Task"]})}),e.jsxs(Ue,{className:"max-w-2xl",children:[e.jsxs(_e,{children:[e.jsx($e,{children:"Create New Task"}),e.jsx(Ge,{children:"Add a new task to track progress and manage your workload."})]}),e.jsx(Ie,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(h),className:"space-y-4",children:[e.jsx(F,{control:m.control,name:"name",render:({field:s})=>e.jsxs(M,{children:[e.jsx(A,{children:"Task Name"}),e.jsx(I,{children:e.jsx(V,{placeholder:"Enter task name...",...s})})]})}),e.jsx(F,{control:m.control,name:"description",render:({field:s})=>e.jsxs(M,{children:[e.jsx(A,{children:"Description"}),e.jsx(I,{children:e.jsx(Oe,{placeholder:"Describe the task...",rows:3,...s})})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(F,{control:m.control,name:"priority",render:({field:s})=>e.jsxs(M,{children:[e.jsx(A,{children:"Priority"}),e.jsxs(B,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(I,{children:e.jsx(K,{children:e.jsx(Q,{placeholder:"Select priority"})})}),e.jsxs(R,{children:[e.jsx(l,{value:"low",children:"Low"}),e.jsx(l,{value:"medium",children:"Medium"}),e.jsx(l,{value:"high",children:"High"})]})]})]})}),e.jsx(F,{control:m.control,name:"category",render:({field:s})=>e.jsxs(M,{children:[e.jsx(A,{children:"Category"}),e.jsx(I,{children:e.jsx(V,{placeholder:"e.g., Development, Marketing",...s,value:s.value||""})})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(F,{control:m.control,name:"estimatedMinutes",render:({field:s})=>e.jsxs(M,{children:[e.jsx(A,{children:"Estimated Time (minutes)"}),e.jsx(I,{children:e.jsx(V,{type:"number",placeholder:"60",...s,onChange:a=>s.onChange(parseInt(a.target.value)||0),value:s.value||""})})]})}),e.jsx(F,{control:m.control,name:"assignedTo",render:({field:s})=>e.jsxs(M,{children:[e.jsx(A,{children:"Assigned To"}),e.jsx(I,{children:e.jsx(V,{placeholder:"Team member name",...s,value:s.value||""})})]})})]}),e.jsxs(He,{children:[e.jsx(E,{type:"button",variant:"outline",onClick:()=>T(!1),children:"Cancel"}),e.jsx(E,{type:"submit",disabled:i.isPending,children:i.isPending?"Creating...":"Create Task"})]})]})})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(S,{children:[e.jsx(k,{className:"pb-2",children:e.jsx(D,{className:"text-sm font-medium text-slate-600",children:"Total Tasks"})}),e.jsxs(P,{children:[e.jsx("div",{className:"text-2xl font-bold",children:x.totalTasks}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:[x.completedTasks," completed"]})]})]}),e.jsxs(S,{children:[e.jsx(k,{className:"pb-2",children:e.jsx(D,{className:"text-sm font-medium text-slate-600",children:"Completion Rate"})}),e.jsxs(P,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(x.completionRate),"%"]}),e.jsx(me,{value:x.completionRate,className:"h-2 mt-2"})]})]}),e.jsxs(S,{children:[e.jsx(k,{className:"pb-2",children:e.jsx(D,{className:"text-sm font-medium text-slate-600",children:"Time Tracked"})}),e.jsxs(P,{children:[e.jsx("div",{className:"text-2xl font-bold",children:ie(x.totalTimeSpent)}),e.jsxs("div",{className:"text-xs text-slate-500 mt-1",children:["of ",ie(x.totalEstimatedTime)," estimated"]})]})]}),e.jsxs(S,{children:[e.jsx(k,{className:"pb-2",children:e.jsx(D,{className:"text-sm font-medium text-slate-600",children:"Overdue Tasks"})}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:x.overdueTasks}),x.overdueTasks>0&&e.jsx(de,{className:"w-4 h-4 text-red-500"})]})})]})]}),e.jsxs(S,{children:[e.jsx(k,{children:e.jsx(D,{className:"text-lg",children:"Priority Distribution"})}),e.jsx(P,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(N,{variant:"destructive",className:"flex items-center gap-1",children:["Urgent: ",x.priorityBreakdown.urgent]}),e.jsxs(N,{variant:"secondary",className:"flex items-center gap-1 bg-orange-100 text-orange-800",children:["High: ",x.priorityBreakdown.high]}),e.jsxs(N,{variant:"secondary",className:"flex items-center gap-1 bg-yellow-100 text-yellow-800",children:["Medium: ",x.priorityBreakdown.medium]}),e.jsxs(N,{variant:"secondary",className:"flex items-center gap-1 bg-green-100 text-green-800",children:["Low: ",x.priorityBreakdown.low]})]})})]}),e.jsxs(S,{children:[e.jsx(k,{children:e.jsxs(D,{className:"text-lg flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),"Filters & Search"]})}),e.jsx(P,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(V,{placeholder:"Search tasks...",value:_,onChange:s=>g(s.target.value),className:"w-full"})}),e.jsxs(B,{value:d,onValueChange:W,children:[e.jsx(K,{children:e.jsx(Q,{placeholder:"Status"})}),e.jsxs(R,{children:[e.jsx(l,{value:"all",children:"All Status"}),e.jsx(l,{value:"pending",children:"Pending"}),e.jsx(l,{value:"in_progress",children:"In Progress"}),e.jsx(l,{value:"completed",children:"Completed"})]})]}),e.jsxs(B,{value:v,onValueChange:$,children:[e.jsx(K,{children:e.jsx(Q,{placeholder:"Priority"})}),e.jsxs(R,{children:[e.jsx(l,{value:"all",children:"All Priorities"}),e.jsx(l,{value:"urgent",children:"Urgent"}),e.jsx(l,{value:"high",children:"High"}),e.jsx(l,{value:"medium",children:"Medium"}),e.jsx(l,{value:"low",children:"Low"})]})]}),e.jsxs(B,{value:b,onValueChange:X,children:[e.jsx(K,{children:e.jsx(Q,{placeholder:"Category"})}),e.jsxs(R,{children:[e.jsx(l,{value:"all",children:"All Categories"}),he.map(s=>e.jsx(l,{value:s,children:s},s))]})]}),e.jsxs(B,{value:y,onValueChange:Y,children:[e.jsx(K,{children:e.jsx(Q,{placeholder:"Assignee"})}),e.jsxs(R,{children:[e.jsx(l,{value:"all",children:"All Assignees"}),xe.map(s=>e.jsx(l,{value:s,children:s},s))]})]})]})})]}),e.jsxs(Se,{defaultValue:"kanban",className:"w-full",children:[e.jsxs(ke,{children:[e.jsx(le,{value:"kanban",children:"Kanban View"}),e.jsx(le,{value:"list",children:"List View"})]}),e.jsx(ce,{value:"kanban",className:"mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:O,children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5 text-yellow-500"}),"Pending (",p.pending.length,")"]}),e.jsx("div",{className:"space-y-4",children:p.pending.length===0?e.jsx("p",{className:"text-slate-500 text-center py-8",children:"No pending tasks"}):p.pending.map(s=>e.jsx(J,{task:s,onToggleStatus:G,onUpdateTime:H},s.id))})]}),e.jsxs("div",{className:O,children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-blue-500"}),"In Progress (",p.in_progress.length,")"]}),e.jsx("div",{className:"space-y-4",children:p.in_progress.length===0?e.jsx("p",{className:"text-slate-500 text-center py-8",children:"No tasks in progress"}):p.in_progress.map(s=>e.jsx(J,{task:s,onToggleStatus:G,onUpdateTime:H},s.id))})]}),e.jsxs("div",{className:O,children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900 mb-4 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-green-500"}),"Completed (",p.completed.length,")"]}),e.jsx("div",{className:"space-y-4",children:p.completed.length===0?e.jsx("p",{className:"text-slate-500 text-center py-8",children:"No completed tasks"}):p.completed.map(s=>e.jsx(J,{task:s,onToggleStatus:G,onUpdateTime:H},s.id))})]})]})}),e.jsx(ce,{value:"list",className:"mt-6",children:e.jsx("div",{className:O,children:e.jsx("div",{className:"space-y-4",children:C.length===0?e.jsx("p",{className:"text-slate-500 text-center py-8",children:"No tasks match your filters"}):C.map(s=>e.jsx(J,{task:s,onToggleStatus:G,onUpdateTime:H},s.id))})})})]})]})})}export{us as EnhancedTasks};
